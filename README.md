# neuralkey
Neural Key Exchange using Tree Parity Machine in Python

**Hi!** This is an implementaion of the Neural Key Exchange Protocol in python written with simplicity, understandability and code readability in mind. Suiltable for academic and researh purposes. The code is documented line by line, so lets get straight to theory.
___
**Diffie–Hellman key exchange**

If Alice and Bob wish to communicate with each other by exchanging encrypted messages, each of them should be able to decrypt the messages received from the other. And to do so, they have to exchange the keys with which the messages will be encrypted, and should be carefull not to let Eve get hold of the keys, or else she too would be able to decrypt the messages. So a secure protocol should be used for exchanging the keys, or else nosy Eve would be able to read all of Bob's and Alice's messages.
Neural or not, the most used protocol for key exchange between two parties A and B is the [Diffie-Hellman protocol](https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange). Diffie–Hellman Key Exchange establishes a shared secret between two parties that can be used for secret communication for exchanging data over a public network. The following conceptual diagram illustrates the general idea of the key exchange by using colors instead of very large numbers:

![Diffe-Hellman](https://upload.wikimedia.org/wikipedia/commons/thumb/4/46/Diffie-Hellman_Key_Exchange.svg/250px-Diffie-Hellman_Key_Exchange.svg.png)
____
**Neural Key Exchange Protocol**

The Diffe-Hellman protocol can be implemented using a neural neural network with a single hidden layer (also called a tree parity machine). The number neurons in the hidden layer is denoted as `K` and the number of input neurons per hidden neuron is denoted as 'N'. There is a weight matrix `W` between the input and hidden layers of dimensions `K`x`N` and the range of each weight is `{-L, ..., -2, -1, 0, 1, 2, ..., +L}` where `L` is a parameter of the tree.

![tpm](data:image/png;base64,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)

Both Bob and Alice posses tree parity machines with same set of parameters (`K`, `N` and `L`). The weights of their machines are different, as they are randomly initialized. If they could synchronize the weights of their machines (without transferring the actual weights, ofcourse) they could then use those weights as a cryptographic key for the rest of their communication. The following algorithm is used to synchronize the weight matrices of Bob's and Alice's machines:

![algorith](http://i66.tinypic.com/rk0jd5.png)

For a given random input vector x (of dimensions [`K`,`N`]), the output (tau) of a tree parity machine is computed as follows:

![eqn1](https://upload.wikimedia.org/math/3/7/8/378239a5ebfd6a4909c41bfb56290785.png)

![eqn2](https://upload.wikimedia.org/math/f/0/c/f0cc1ef36d3e0ed3122a4d5bb5174b24.png)

![eqn2](https://upload.wikimedia.org/math/f/6/c/f6c71d6ddb62c05156e28257d2ee7321.png)

![eqn3](https://upload.wikimedia.org/math/2/6/c/26ca3289b0a374f571997861520afd19.png)

![eqn4](https://upload.wikimedia.org/math/8/e/2/8e294fb8aa31d991f17adb60962a35ba.png)

And if the outputs of both Alice's and Bob's machines are equal, their weights are update using any of the following rules:

* Hebbian rule:

![hebbian](https://upload.wikimedia.org/math/e/a/0/ea00bf9f38c084eb3dd2f05f18d7c7f8.png)

* Anti-hebbian rule:

![anti-hebbian](https://upload.wikimedia.org/math/4/b/e/4be8643c90715a90d50f1699dcccffb5.png)

* Random-walk:

![random-walk](https://upload.wikimedia.org/math/2/7/4/274044e2c0b5f84e79f7080270a4d48d.png)
___

# The Code

The code is heavily documented. It consists of 3 files, `machine.py`, which defines a tree parity machine, `update_rules.py`, which contains functions for all the three update rules and `run.py` which simple creates 2 machines with default parameters and try to sync them.

**Installation**

```
sudo git clone http://www.github.com/farizrahman4u/neuralkey.git
cd neuralkey
python run.py
```

**Requirements**
* [Numpy](www.numpy.org)
* [Matplotlib](www.matplotlib.org)
